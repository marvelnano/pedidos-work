<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pedidos | Gestión</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="app-header">
    <div class="header-bar">
      <h1>Gestión de Pedidos</h1>
      <div class="header-actions">
        <button class="secondary" id="btn-exportar">Exportar JSON</button>
        <input type="file" id="file-import" accept="application/json,.json" hidden />
        <button class="secondary" id="btn-importar">Importar JSON</button>
        <button class="secondary" id="btn-guardar-archivo" title="Requiere Chrome/Edge en https o localhost">Guardar archivo</button>
        <button class="secondary" id="btn-abrir-archivo" title="Requiere Chrome/Edge en https o localhost">Abrir archivo</button>
      </div>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="personas">Personas</button>
      <button class="tab" data-tab="responsables">Responsable de Comprar</button>
      <button class="tab" data-tab="productos">Productos</button>
      <button class="tab" data-tab="pedidos">Pedidos</button>
    </nav>
  </header>

  <main class="container">
    <!-- Personas -->
    <section id="tab-personas" class="tab-panel active">
      <div class="panel-header">
        <h2>Personas</h2>
        <button class="primary" id="btn-add-persona">Agregar Persona</button>
      </div>
      <div class="card">
        <div class="grid grid-2">
          <div>
            <label>Buscar</label>
            <input type="text" id="input-buscar-persona" placeholder="Nombre..." />
          </div>
          <div>
            <label>Límite sugerido</label>
            <input type="number" id="input-limite-personas" min="1" value="10" />
          </div>
        </div>
        <table class="table" id="tabla-personas">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Activo</th>
              <th class="right">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Responsables -->
    <section id="tab-responsables" class="tab-panel">
      <div class="panel-header">
        <h2>Responsable de Comprar</h2>
        <div class="actions">
          <button class="primary" id="btn-rotar-responsables">Rotar Semana (L-V)</button>
          <button class="secondary" id="btn-limpiar-rotacion">Limpiar Rotación</button>
        </div>
      </div>

      <div class="card">
        <p class="muted">La rotación asigna automáticamente a las personas activas de forma circular para los días lunes a viernes.</p>
        <div class="grid grid-2 grid-responsive">
          <div>
            <h3>Semana Actual</h3>
            <table class="table" id="tabla-rotacion">
              <thead>
                <tr>
                  <th>Día</th>
                  <th>Responsable</th>
                  <th class="right">Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div>
            <h3>Historial</h3>
            <table class="table" id="tabla-historial">
              <thead>
                <tr>
                  <th>Semana</th>
                  <th>Ruta</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- Productos -->
    <section id="tab-productos" class="tab-panel">
      <div class="panel-header">
        <h2>Productos</h2>
        <button class="primary" id="btn-add-producto">Agregar Producto</button>
      </div>
      <div class="card">
        <div class="grid grid-3">
          <div>
            <label>Buscar</label>
            <input type="text" id="input-buscar-producto" placeholder="Nombre o descripción..." />
          </div>
          <div>
            <label>Rango de precios</label>
            <div class="grid grid-2">
              <input type="number" id="prod-precio-min" placeholder="Mín" min="0" />
              <input type="number" id="prod-precio-max" placeholder="Máx" min="0" />
            </div>
          </div>
          <div>
            <label>Estado</label>
            <select id="prod-estado">
              <option value="">Todos</option>
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
            </select>
          </div>
        </div>
        <table class="table" id="tabla-productos">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Descripción</th>
              <th class="right">Precio</th>
              <th>Estado</th>
              <th class="right">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Pedidos -->
    <section id="tab-pedidos" class="tab-panel">
      <div class="panel-header">
        <h2>Pedidos</h2>
        <button class="primary" id="btn-add-pedido">Agregar Pedido</button>
      </div>

      <div class="card">
        <div class="grid grid-3">
          <div>
            <label>Persona</label>
            <input type="text" id="persona-pedidos-input" list="datalist-personas" placeholder="Escribe y selecciona..." />
            <datalist id="datalist-personas"></datalist>
          </div>
          <div>
            <label>Buscar</label>
            <input type="text" id="input-buscar-pedido" placeholder="Descripción..." />
          </div>
          <div>
            <label>Rango de precios</label>
            <div class="grid grid-2">
              <input type="number" id="precio-min" placeholder="Mín" min="0" />
              <input type="number" id="precio-max" placeholder="Máx" min="0" />
            </div>
          </div>
        </div>

        <table class="table" id="tabla-pedidos">
          <thead>
            <tr>
              <th>Persona</th>
              <th>Descripción</th>
              <th class="right">Cantidad</th>
              <th class="right">Precio</th>
              <th class="right">Total</th>
              <th class="right">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td colspan="4" class="right"><strong>Total General</strong></td>
              <td class="right" id="total-general">0.00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
      <!--<div class="card" id="resumen-subtotales">
        <h3>Subtotal por persona</h3>
        <table class="table">
          <thead>
            <tr>
              <th>Persona</th>
              <th class="right">Subtotal</th>
            </tr>
          </thead>
          <tbody id="tabla-subtotales"></tbody>
        </table>
      </div>-->
    </section>
  </main>

  <!-- Modales -->
  <dialog id="modal-persona" class="modal">
    <form method="dialog" id="form-persona" class="form">
      <h3 id="titulo-modal-persona">Agregar Persona</h3>
      <label>Nombre</label>
      <input type="text" id="persona-nombre" required />
      <label class="checkbox">
        <input type="checkbox" id="persona-activo" checked />
        <span>Activo</span>
      </label>
      <div class="modal-actions">
        <button type="button" value="cancel" class="secondary" id="btn-cancel-persona">Cancelar</button>
        <button type="submit" class="primary">Guardar</button>
      </div>
    </form>
  </dialog>

  <dialog id="modal-producto" class="modal">
    <form method="dialog" id="form-producto" class="form">
      <h3 id="titulo-modal-producto">Agregar Producto</h3>
      <label>Nombre</label>
      <input type="text" id="producto-nombre" required />
      <label>Descripción</label>
      <input type="text" id="producto-descripcion" />
      <div class="grid grid-2">
        <div>
          <label>Precio</label>
          <input type="number" id="producto-precio" min="0" step="0.01" value="0" required />
        </div>
        <div class="checkbox">
          <input type="checkbox" id="producto-activo" checked />
          <span>Activo</span>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" value="cancel" class="secondary" id="btn-cancel-producto">Cancelar</button>
        <button type="submit" class="primary">Guardar</button>
      </div>
    </form>
  </dialog>

  <dialog id="modal-pedido" class="modal">
    <form method="dialog" id="form-pedido" class="form">
      <h3 id="titulo-modal-pedido">Agregar Pedido</h3>
      <label>Persona</label>
      <input type="text" id="pedido-persona-input" list="datalist-personas-modal" placeholder="Escribe y selecciona..." required />
      <datalist id="datalist-personas-modal"></datalist>
      <label>Producto frecuente</label>
      <input type="text" id="pedido-producto-input" list="datalist-productos" placeholder="(Opcional) Escribe para autocompletar" />
      <datalist id="datalist-productos"></datalist>
      <label>Descripción</label>
      <input type="text" id="pedido-descripcion" required />
      <div class="grid grid-2">
        <div>
          <label>Cantidad</label>
          <input type="number" id="pedido-cantidad" min="1" value="1" required />
        </div>
        <div>
          <label>Precio</label>
          <input type="number" id="pedido-precio" min="0" step="0.01" value="0" required />
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" value="cancel" class="secondary" id="btn-cancel-pedido">Cancelar</button>
        <button type="submit" class="primary">Guardar</button>
      </div>
    </form>
  </dialog>

  <dialog id="modal-responsable" class="modal">
    <form method="dialog" id="form-responsable" class="form">
      <h3 id="titulo-modal-responsable">Editar Responsable</h3>
      <input type="hidden" id="responsable-dia" />
      <label>Persona</label>
      <input type="text" id="responsable-persona-input" list="datalist-personas-modal" placeholder="Escribe y selecciona..." required />
      <div class="modal-actions">
        <button type="button" value="cancel" class="secondary" id="btn-cancel-responsable">Cancelar</button>
        <button type="submit" class="primary">Guardar</button>
      </div>
    </form>
  </dialog>

  <script src="data.js"></script>
  <script src="app.js"></script>
  <div id="toast-container" aria-live="polite" aria-atomic="true"></div>
</body>
</html>
